<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yaniv Scoring Logic Playground</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #1a1a1a;
      color: #e0e0e0;
      padding: 24px;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 400px 1fr;
      gap: 24px;
      min-height: calc(100vh - 48px);
    }

    .controls {
      background: #252525;
      border-radius: 12px;
      padding: 24px;
      overflow-y: auto;
      max-height: calc(100vh - 48px);
    }

    .preview-area {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .preview {
      background: #252525;
      border-radius: 12px;
      padding: 32px;
      flex: 1;
      overflow-y: auto;
    }

    .prompt-section {
      background: #2a2a2a;
      border-radius: 12px;
      padding: 20px;
      border: 1px solid #3a3a3a;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 8px;
      color: #fff;
    }

    h2 {
      font-size: 18px;
      margin: 24px 0 12px 0;
      color: #fff;
      border-bottom: 1px solid #3a3a3a;
      padding-bottom: 8px;
    }

    h2:first-child { margin-top: 0; }

    h3 {
      font-size: 14px;
      color: #10b981;
      margin: 16px 0 8px 0;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .subtitle {
      color: #888;
      font-size: 14px;
      margin-bottom: 24px;
    }

    .control-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      font-size: 13px;
      color: #aaa;
      margin-bottom: 6px;
      font-weight: 500;
    }

    input[type="number"],
    input[type="range"],
    select {
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      color: #e0e0e0;
      padding: 10px 12px;
      border-radius: 6px;
      font-size: 14px;
      font-family: inherit;
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #10b981;
    }

    input[type="range"] {
      padding: 0;
      height: 6px;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #10b981;
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #10b981;
      cursor: pointer;
      border: none;
    }

    .range-value {
      display: inline-block;
      margin-left: 8px;
      color: #10b981;
      font-weight: 600;
      min-width: 40px;
    }

    .presets {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 24px;
    }

    .preset-btn {
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      color: #e0e0e0;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
      font-family: inherit;
    }

    .preset-btn:hover {
      background: #2a2a2a;
      border-color: #10b981;
    }

    .player-inputs {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
    }

    .player-input {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: 8px;
      align-items: center;
    }

    .player-input label {
      margin: 0;
      text-align: right;
    }

    .yaniv-caller-select {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }

    .yaniv-btn {
      background: #1a1a1a;
      border: 2px solid #3a3a3a;
      color: #e0e0e0;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
      font-family: inherit;
    }

    .yaniv-btn.active {
      background: #10b981;
      border-color: #10b981;
      color: #1a1a1a;
      font-weight: 600;
    }

    .yaniv-btn:hover:not(.active) {
      border-color: #10b981;
    }

    .result-card {
      background: #1a1a1a;
      border: 1px solid #3a3a3a;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
    }

    .result-card.winner {
      border-color: #10b981;
      background: rgba(16, 185, 129, 0.05);
    }

    .result-card.false-yaniv {
      border-color: #ef4444;
      background: rgba(239, 68, 68, 0.05);
    }

    .player-name {
      font-size: 18px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .badge.winner { background: #10b981; color: #1a1a1a; }
    .badge.false-yaniv { background: #ef4444; color: #fff; }
    .badge.bonus { background: #f59e0b; color: #1a1a1a; }

    .score-breakdown {
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 8px 16px;
      margin-top: 12px;
      font-size: 14px;
    }

    .score-label {
      color: #888;
    }

    .score-value {
      text-align: right;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      color: #10b981;
      font-weight: 600;
    }

    .score-value.penalty {
      color: #ef4444;
    }

    .explanation {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #3a3a3a;
      font-size: 14px;
      color: #aaa;
      line-height: 1.6;
    }

    .explanation strong {
      color: #10b981;
    }

    .copy-btn {
      background: #10b981;
      color: #1a1a1a;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: all 0.15s;
      margin-top: 12px;
    }

    .copy-btn:hover {
      background: #059669;
    }

    .copy-btn.copied {
      background: #3a3a3a;
      color: #10b981;
    }

    #prompt {
      font-family: inherit;
      font-size: 14px;
      line-height: 1.6;
      color: #e0e0e0;
      white-space: pre-wrap;
    }

    .visual-round {
      display: flex;
      justify-content: space-around;
      margin: 24px 0;
      padding: 20px;
      background: #1a1a1a;
      border-radius: 8px;
    }

    .visual-player {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #3a3a3a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 600;
      color: #fff;
      position: relative;
    }

    .avatar.yaniv-caller {
      border: 3px solid #10b981;
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
    }

    .avatar.winner::after {
      content: 'üëë';
      position: absolute;
      top: -10px;
      right: -10px;
      font-size: 20px;
    }

    .hand-score {
      font-size: 20px;
      font-weight: 600;
      color: #10b981;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
    }

    .player-label {
      font-size: 12px;
      color: #888;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <h1>‚öôÔ∏è Controls</h1>
      <p class="subtitle">Configure a Yaniv round scenario</p>

      <div class="presets">
        <button class="preset-btn" onclick="loadPreset('normal')">Normal Win</button>
        <button class="preset-btn" onclick="loadPreset('falseYaniv')">False Yaniv</button>
        <button class="preset-btn" onclick="loadPreset('bonus')">50-Bonus</button>
        <button class="preset-btn" onclick="loadPreset('complex')">Complex</button>
      </div>

      <h2>Players</h2>

      <div class="control-group">
        <label>Number of Players</label>
        <input type="range" id="playerCount" min="2" max="6" value="4" oninput="updatePlayerCount(this.value)">
        <span class="range-value" id="playerCountValue">4</span>
      </div>

      <div class="control-group">
        <label>Who called Yaniv?</label>
        <div class="yaniv-caller-select" id="yanivCallerSelect"></div>
      </div>

      <h3>Hand Scores</h3>
      <div class="player-inputs" id="handScores"></div>

      <h3>Previous Cumulative Scores</h3>
      <div class="player-inputs" id="cumulativeScores"></div>

      <h2>House Rules</h2>

      <div class="control-group">
        <label>False Yaniv Penalty</label>
        <input type="range" id="penalty" min="10" max="50" step="5" value="25" oninput="updateAll()">
        <span class="range-value" id="penaltyValue">25</span>
      </div>

      <div class="control-group">
        <label>50-Bonus Type</label>
        <select id="bonusType" onchange="updateAll()">
          <option value="subtract25">Subtract 25</option>
          <option value="halve">Halve Score</option>
          <option value="none">None</option>
        </select>
      </div>
    </div>

    <div class="preview-area">
      <div class="preview">
        <h1>üéÆ Yaniv Scoring Logic</h1>
        <p class="subtitle">Live visualization of how the scoring works</p>

        <div id="visualRound"></div>

        <div id="results"></div>

        <div class="explanation" id="explanation"></div>
      </div>

      <div class="prompt-section">
        <h2 style="margin-top: 0;">üìã Generated Prompt</h2>
        <div id="prompt"></div>
        <button class="copy-btn" onclick="copyPrompt()">Copy Prompt</button>
      </div>
    </div>
  </div>

  <script>
    const DEFAULTS = {
      playerCount: 4,
      yanivCaller: 0,
      handScores: [3, 12, 18, 25],
      cumulativeScores: [0, 0, 0, 0],
      penalty: 25,
      bonusType: 'subtract25'
    };

    const state = { ...DEFAULTS };

    const PLAYER_NAMES = ['Alice', 'Bob', 'Charlie', 'Diana', 'Eve', 'Frank'];

    function updatePlayerCount(count) {
      state.playerCount = parseInt(count);
      document.getElementById('playerCountValue').textContent = count;

      // Adjust arrays
      while (state.handScores.length < count) {
        state.handScores.push(10);
        state.cumulativeScores.push(0);
      }
      while (state.handScores.length > count) {
        state.handScores.pop();
        state.cumulativeScores.pop();
      }

      // Reset yaniv caller if out of range
      if (state.yanivCaller >= count) {
        state.yanivCaller = 0;
      }

      renderPlayerInputs();
      updateAll();
    }

    function renderPlayerInputs() {
      const handScoresEl = document.getElementById('handScores');
      const cumulativeScoresEl = document.getElementById('cumulativeScores');
      const yanivCallerEl = document.getElementById('yanivCallerSelect');

      handScoresEl.innerHTML = '';
      cumulativeScoresEl.innerHTML = '';
      yanivCallerEl.innerHTML = '';

      for (let i = 0; i < state.playerCount; i++) {
        // Hand scores
        const handDiv = document.createElement('div');
        handDiv.className = 'player-input';
        handDiv.innerHTML = `
          <label>${PLAYER_NAMES[i]}:</label>
          <input type="number" min="0" max="50" value="${state.handScores[i]}" oninput="updateHandScore(${i}, this.value)">
        `;
        handScoresEl.appendChild(handDiv);

        // Cumulative scores
        const cumDiv = document.createElement('div');
        cumDiv.className = 'player-input';
        cumDiv.innerHTML = `
          <label>${PLAYER_NAMES[i]}:</label>
          <input type="number" min="0" max="200" value="${state.cumulativeScores[i]}" oninput="updateCumulativeScore(${i}, this.value)">
        `;
        cumulativeScoresEl.appendChild(cumDiv);

        // Yaniv caller buttons
        const btn = document.createElement('button');
        btn.className = 'yaniv-btn' + (i === state.yanivCaller ? ' active' : '');
        btn.textContent = PLAYER_NAMES[i];
        btn.onclick = () => {
          state.yanivCaller = i;
          renderPlayerInputs();
          updateAll();
        };
        yanivCallerEl.appendChild(btn);
      }
    }

    function updateHandScore(index, value) {
      state.handScores[index] = parseInt(value) || 0;
      updateAll();
    }

    function updateCumulativeScore(index, value) {
      state.cumulativeScores[index] = parseInt(value) || 0;
      updateAll();
    }

    function calculateRound() {
      const results = [];
      const yanivCallerId = state.yanivCaller;
      const yanivCallerHand = state.handScores[yanivCallerId];

      // Check for False Yaniv
      let isFalseYaniv = false;
      let falseYanivWinners = [];

      for (let i = 0; i < state.playerCount; i++) {
        if (i !== yanivCallerId && state.handScores[i] <= yanivCallerHand) {
          isFalseYaniv = true;
          falseYanivWinners.push(i);
        }
      }

      // Calculate scores for each player
      for (let i = 0; i < state.playerCount; i++) {
        const isYanivCaller = i === yanivCallerId;
        const isWinner = isFalseYaniv ? falseYanivWinners.includes(i) : isYanivCaller;

        let pointsAdded = 0;
        let explanation = '';

        if (isFalseYaniv) {
          if (isYanivCaller) {
            pointsAdded = state.handScores[i] + parseInt(state.penalty);
            explanation = `Hand (${state.handScores[i]}) + False Yaniv Penalty (${state.penalty})`;
          } else if (isWinner) {
            pointsAdded = 0;
            explanation = 'Won by calling out False Yaniv!';
          } else {
            pointsAdded = state.handScores[i];
            explanation = `Hand total (${state.handScores[i]})`;
          }
        } else {
          if (isYanivCaller) {
            pointsAdded = 0;
            explanation = 'Called Yaniv and won with lowest hand!';
          } else {
            pointsAdded = state.handScores[i];
            explanation = `Hand total (${state.handScores[i]})`;
          }
        }

        const newCumulative = state.cumulativeScores[i] + pointsAdded;

        // Check for 50-bonus
        let bonus = null;
        if (state.bonusType !== 'none' && newCumulative > 0 && newCumulative % 50 === 0) {
          if (state.bonusType === 'subtract25') {
            bonus = { type: 'subtract', amount: 25, newScore: newCumulative - 25 };
            explanation += ` ‚Üí Hit ${newCumulative}! Bonus: -25`;
          } else if (state.bonusType === 'halve') {
            bonus = { type: 'halve', newScore: newCumulative / 2 };
            explanation += ` ‚Üí Hit ${newCumulative}! Bonus: √∑2`;
          }
        }

        const finalScore = bonus ? bonus.newScore : newCumulative;

        results.push({
          name: PLAYER_NAMES[i],
          isYanivCaller,
          isWinner,
          handScore: state.handScores[i],
          previousScore: state.cumulativeScores[i],
          pointsAdded,
          newCumulative,
          bonus,
          finalScore,
          explanation
        });
      }

      return { results, isFalseYaniv, falseYanivWinners };
    }

    function renderPreview() {
      const { results, isFalseYaniv } = calculateRound();

      // Visual round
      const visualEl = document.getElementById('visualRound');
      visualEl.innerHTML = '<h3>Visual Round</h3>';
      const playersDiv = document.createElement('div');
      playersDiv.className = 'visual-round';

      results.forEach(r => {
        const playerDiv = document.createElement('div');
        playerDiv.className = 'visual-player';
        playerDiv.innerHTML = `
          <div class="avatar ${r.isYanivCaller ? 'yaniv-caller' : ''} ${r.isWinner ? 'winner' : ''}">
            ${r.name[0]}
          </div>
          <div class="hand-score">${r.handScore}</div>
          <div class="player-label">${r.name}</div>
        `;
        playersDiv.appendChild(playerDiv);
      });
      visualEl.appendChild(playersDiv);

      // Results cards
      const resultsEl = document.getElementById('results');
      resultsEl.innerHTML = '<h3>Score Breakdown</h3>';

      results.forEach(r => {
        const card = document.createElement('div');
        card.className = 'result-card' + (r.isWinner ? ' winner' : '') + (r.isYanivCaller && isFalseYaniv ? ' false-yaniv' : '');

        let badges = '';
        if (r.isWinner) badges += '<span class="badge winner">Winner</span>';
        if (r.isYanivCaller && isFalseYaniv) badges += '<span class="badge false-yaniv">False Yaniv</span>';
        if (r.bonus) badges += '<span class="badge bonus">50-Bonus</span>';

        card.innerHTML = `
          <div class="player-name">${r.name} ${badges}</div>
          <div class="score-breakdown">
            <span class="score-label">Previous:</span>
            <span></span>
            <span class="score-value">${r.previousScore}</span>

            <span class="score-label">This round:</span>
            <span></span>
            <span class="score-value ${r.pointsAdded > 0 ? 'penalty' : ''}">+${r.pointsAdded}</span>

            ${r.bonus ? `
              <span class="score-label">Before bonus:</span>
              <span></span>
              <span class="score-value">${r.newCumulative}</span>

              <span class="score-label">Bonus applied:</span>
              <span></span>
              <span class="score-value">${r.bonus.type === 'subtract' ? '-' + r.bonus.amount : '√∑2'}</span>
            ` : ''}

            <span class="score-label"><strong>Final score:</strong></span>
            <span></span>
            <span class="score-value"><strong>${r.finalScore}</strong></span>
          </div>
          <div class="explanation">${r.explanation}</div>
        `;
        resultsEl.appendChild(card);
      });

      // Explanation
      const explanationEl = document.getElementById('explanation');
      if (isFalseYaniv) {
        explanationEl.innerHTML = `
          <h3>What happened?</h3>
          <p><strong>False Yaniv!</strong> ${PLAYER_NAMES[state.yanivCaller]} called Yaniv with a hand of ${state.handScores[state.yanivCaller]}, but ${results.filter(r => r.isWinner && !r.isYanivCaller).map(r => r.name).join(' and ')} had an equal or lower hand. The caller gets penalized with their hand total PLUS ${state.penalty} points, while the winners score 0.</p>
        `;
      } else {
        explanationEl.innerHTML = `
          <h3>What happened?</h3>
          <p><strong>Normal Yaniv win!</strong> ${PLAYER_NAMES[state.yanivCaller]} successfully called Yaniv with the lowest hand (${state.handScores[state.yanivCaller]}). They score 0 points, while all other players add their hand totals to their cumulative scores.</p>
        `;
      }
    }

    function updatePrompt() {
      const { results, isFalseYaniv } = calculateRound();
      const prompt = document.getElementById('prompt');

      let text = `Implement Yaniv scoring logic for a round where:\n\n`;
      text += `Players: ${results.map(r => r.name).join(', ')}\n`;
      text += `Yaniv Caller: ${PLAYER_NAMES[state.yanivCaller]} (hand: ${state.handScores[state.yanivCaller]})\n`;
      text += `Hand Scores: ${results.map(r => `${r.name}=${r.handScore}`).join(', ')}\n`;
      text += `Previous Scores: ${results.map(r => `${r.name}=${r.previousScore}`).join(', ')}\n\n`;

      text += `Rules:\n`;
      text += `- False Yaniv Penalty: ${state.penalty} points\n`;
      text += `- 50-Bonus Type: ${state.bonusType === 'subtract25' ? 'Subtract 25' : state.bonusType === 'halve' ? 'Halve score' : 'None'}\n\n`;

      text += `Expected Result:\n`;
      if (isFalseYaniv) {
        text += `- This is a FALSE YANIV (${results.filter(r => r.isWinner && !r.isYanivCaller).map(r => r.name).join(' and ')} had equal/lower hands)\n`;
      } else {
        text += `- Normal Yaniv win for ${PLAYER_NAMES[state.yanivCaller]}\n`;
      }

      text += `\nFinal scores should be:\n`;
      results.forEach(r => {
        text += `- ${r.name}: ${r.finalScore}`;
        if (r.bonus) text += ` (with 50-bonus)`;
        text += `\n`;
      });

      prompt.textContent = text;
    }

    function updateAll() {
      document.getElementById('penaltyValue').textContent = document.getElementById('penalty').value;
      state.penalty = parseInt(document.getElementById('penalty').value);
      state.bonusType = document.getElementById('bonusType').value;

      renderPreview();
      updatePrompt();
    }

    function loadPreset(name) {
      switch(name) {
        case 'normal':
          state.playerCount = 4;
          state.yanivCaller = 0;
          state.handScores = [3, 12, 18, 25];
          state.cumulativeScores = [25, 30, 45, 60];
          state.penalty = 25;
          state.bonusType = 'subtract25';
          break;
        case 'falseYaniv':
          state.playerCount = 3;
          state.yanivCaller = 1;
          state.handScores = [3, 5, 12];
          state.cumulativeScores = [20, 35, 40];
          state.penalty = 25;
          state.bonusType = 'subtract25';
          break;
        case 'bonus':
          state.playerCount = 4;
          state.yanivCaller = 2;
          state.handScores = [15, 8, 2, 20];
          state.cumulativeScores = [35, 42, 48, 65];
          state.penalty = 25;
          state.bonusType = 'subtract25';
          break;
        case 'complex':
          state.playerCount = 5;
          state.yanivCaller = 0;
          state.handScores = [4, 4, 18, 25, 12];
          state.cumulativeScores = [95, 48, 70, 88, 75];
          state.penalty = 30;
          state.bonusType = 'halve';
          break;
      }

      document.getElementById('playerCount').value = state.playerCount;
      document.getElementById('penalty').value = state.penalty;
      document.getElementById('bonusType').value = state.bonusType;

      renderPlayerInputs();
      updateAll();
    }

    function copyPrompt() {
      const prompt = document.getElementById('prompt');
      navigator.clipboard.writeText(prompt.textContent).then(() => {
        const btn = event.target;
        btn.textContent = 'Copied!';
        btn.classList.add('copied');
        setTimeout(() => {
          btn.textContent = 'Copy Prompt';
          btn.classList.remove('copied');
        }, 2000);
      });
    }

    // Initialize
    renderPlayerInputs();
    updateAll();
  </script>
</body>
</html>